<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Schedule Meeting</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* Your custom styles here */
    </style> 
</head>
<body>

    <div class="container">
        <h1>Book an Appointment</h1>
        <div class="appointment-info">
            <p>Kaizen is ready to provide the right solution according to your needs</p>
            <p><strong>30 min</strong></p>
            <p>Book an Appointment to know how Kaizen smartbuild can benefit your Business.</p>
        </div>
        
        <h2>Select a Date & Time</h2>
        <div id="custom-calendar" class="calendar">
            <!-- Calendar will be populated by JavaScript -->
        </div>
        <form action="contact.php" method="post">  
           <label for="date">Select Date:</label>  
           <input type="hidden" id="date" name="date" required> 
       
           <label for="timezone">Select Time Zone:</label>  
           <select id="timezone" name="timezone" required>  
             <option value="Asia/Kolkata">India (IST, GMT+5:30)</option>  
             <!-- Add more time zones as needed -->  
           </select>  
       
           <h2>Select a Time Slot:</h2>  
           <div id="time-slots" class="time-slots"></div> 
       
           <input type="hidden" id="selected-time" name="selected_time">  
           <button type="submit" id="submit-btn" disabled onclick="saveTimeInSessionStorage()">Next</button>  
        </form>  
    </div>

    <script>
      let currentYear, currentMonth;
let selectedSlot = null;

function generateCalendar(year, month) {
    currentYear = year;
    currentMonth = month;
    const calendarElement = document.getElementById('custom-calendar');
    calendarElement.innerHTML = '';

    const navigationDiv = document.createElement('div');
    navigationDiv.innerHTML = `
        <button onclick="changeMonth(-1)">&lt; Prev</button>
        <span>${new Date(year, month).toLocaleString('default', { month: 'long' })} ${year}</span>
        <button onclick="changeMonth(1)">Next &gt;</button>
    `;
    calendarElement.appendChild(navigationDiv);

    const daysInMonth = new Date(year, month + 1, 0).getDate();
    const firstDay = new Date(year, month, 1).getDay();

    const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
    days.forEach(day => {
        const dayHeader = document.createElement('div');
        dayHeader.className = 'calendar-header';
        dayHeader.textContent = day;
        calendarElement.appendChild(dayHeader);
    });

    for (let i = 0; i < firstDay; i++) {
        calendarElement.appendChild(document.createElement('div'));
    }

    const today = new Date();
    for (let i = 1; i <= daysInMonth; i++) {
        const dayElement = document.createElement('div');
        dayElement.className = 'calendar-day';
        dayElement.textContent = i;
        
        const currentDate = new Date(year, month, i);
        if (currentDate < today) {
            dayElement.classList.add('disabled');
            dayElement.style.color = '#ccc';
            dayElement.style.cursor = 'not-allowed';
        } else {
            dayElement.onclick = () => selectDate(year, month, i);
        }
        
        calendarElement.appendChild(dayElement);
    }
}

function changeMonth(delta) {
    currentMonth += delta;
    if (currentMonth > 11) {
        currentMonth = 0;
        currentYear++;
    } else if (currentMonth < 0) {
        currentMonth = 11;
        currentYear--;
    }
    generateCalendar(currentYear, currentMonth);
}

function selectDate(year, month, day) {
    const selectedDate = new Date(year, month, day);
    document.getElementById('date').value = selectedDate.toISOString().split('T')[0];
    
    document.querySelectorAll('.calendar-day').forEach(el => el.classList.remove('selected'));
    event.target.classList.add('selected');

    fetchTimeSlots(selectedDate);
}

function fetchTimeSlots(date) {
    const formattedDate = date.toISOString().split('T')[0];
    fetch(`get_times.php?date=${formattedDate}`)
        .then(response => response.json())
        .then(data => {
            const timeSlotsContainer = document.getElementById('time-slots');
            timeSlotsContainer.innerHTML = '';

            data.forEach(slot => {
                const timeSlot = document.createElement('div');
                timeSlot.className = `time-slot ${slot.available ? 'available' : 'unavailable'}`;
                timeSlot.textContent = slot.time;
                if (slot.available) {
                    timeSlot.onclick = () => selectTimeSlot(slot.time);
                }
                timeSlotsContainer.appendChild(timeSlot);
            });
        })
        .catch(error => {
            console.error('Error fetching time slots:', error);
        });
}

function selectTimeSlot(time) {
    document.getElementById('selected-time').value = time;
    document.getElementById('submit-btn').disabled = false;

    document.querySelectorAll('.time-slot').forEach(el => {
        if (el.textContent === time) {
            el.classList.add('selected');
        } else {
            el.classList.remove('selected');
        }
    });

    saveTimeInSessionStorage();
}

function saveTimeInSessionStorage() {
    const selectedDate = document.getElementById('date');
    const selectedTime = document.getElementById('selected-time');
    sessionStorage.setItem('Date', selectedDate.value);
    sessionStorage.setItem('timeslot', selectedTime.value);
}

// Initialize the calendar
const currentDate = new Date();
generateCalendar(currentDate.getFullYear(), currentDate.getMonth());

// Set up event listeners
document.getElementById('submit-btn').addEventListener('click', saveTimeInSessionStorage);

// Prevent past dates from being selected
var today = new Date().toISOString().split('T')[0];
document.getElementById("date").setAttribute("min", today);
    </script>
    <!-- <script src="script.js"></script> -->
</body>
</html>